<!DOCTYPE html>
<html lang="en" class="light">
<!-- BEGIN: Head -->

<head>
    <meta charset="utf-8">
    <title>Bệnh viện nhi</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="description" content="Bệnh viện nhi">
    <meta name="keywords" content="Bệnh viện nhi">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-1BmE4kWBq78iYhFldvKuhfTAU6auU8tT94WrHftjDbrCEXSU1oBoqyl2QvZ6jIW3" crossorigin="anonymous">
    <link rel="stylesheet" href="./../../public/stylesheets/responsive.css">
    <link rel="stylesheet" href="./../../public/stylesheets/imageuploadify.min.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.7.12/xlsx.core.min.js"></script>
    <script src="./../../public/javascripts/jquery.min.js"></script>
</head>

<body>

    <div id="loading" class="text-center" style="height: 100%; width: 100%; position: fixed; z-index: 1000; display: none;">
        <div style="position: fixed; left: 0;right: 0;top: 0;bottom: 0;opacity: 0.5;background-color: rgb(61, 73, 73);">
        </div>
        <div style="color: white; position: absolute;width: 100%;top: 0;bottom: 0;right: 0;left: 0;margin: auto;height: 100px;" class="col-span-6 sm:col-span-3 xl:col-span-2 flex flex-col justify-end items-center">

            <svg width="20" viewBox="0 0 38 38" xmlns="http://www.w3.org/2000/svg" class="w-8 h-8">
                <defs>
                    <linearGradient x1="8.042%" y1="0%" x2="65.682%" y2="23.865%" id="a">
                        <stop stop-color="rgb(45, 55, 72)" stop-opacity="0" offset="0%"></stop>
                        <stop stop-color="rgb(45, 55, 72)" stop-opacity=".631" offset="63.146%"></stop>
                        <stop stop-color="rgb(45, 55, 72)" offset="100%"></stop>
                    </linearGradient>
                </defs>
                <g fill="none" fill-rule="evenodd">
                    <g transform="translate(1 1)">
                        <path d="M36 18c0-9.94-8.06-18-18-18" id="Oval-2" stroke="url(#a)" stroke-width="3">
                            <animateTransform attributeName="transform" type="rotate" from="0 18 18" to="360 18 18" dur="0.9s" repeatCount="indefinite"></animateTransform>
                        </path>
                        <circle fill="rgb(45, 55, 72)" cx="36" cy="18" r="1">
                            <animateTransform attributeName="transform" type="rotate" from="0 18 18" to="360 18 18" dur="0.9s" repeatCount="indefinite"></animateTransform>
                        </circle>
                    </g>
                </g>
            </svg>

            <div class="text-center text-xs mt-2" style="font-size: 20px;">Đang tải dữ liệu . . .</div>
        </div>
    </div>

    <div class="text-center">
        Thả các file excel sau khi tải ở trang: <a target="_blank" href="https://capdodich.yte.gov.vn/map">capdodich.yte.gov.vn</a> (63 tỉnh thành tương ứng với 63 file excel)
    </div>

    <form id="form_upload" enctype="multipart/form-data" method="post">
        <input autocomplete="off" type="file" name="avatar" accept="*" multiple>
    </form>

    <div class="text-center">
        <button type="button" class="btn btn-success" onclick="save()">Sau khi thả file, nhấn vào đây để cập nhật cấp độ dịch</button>
    </div>


    <script>
        function save() {

            $('#loading').show()
            var files = $('input[name=avatar]')[0].files

            console.log(files)

            $('#form_upload').unbind()

            $('#form_upload').on('submit', (function(e) {
                e.preventDefault()
                var formData = new FormData(this)
                formData.append('avatar', files)
                $.ajax({
                    type: 'POST',
                    url: '/update-zone',
                    headers: {
                        // 'Content-Type': 'application/x-www-form-urlencoded; charset=UTF-8',
                    },
                    data: formData,
                    cache: false,
                    contentType: false,
                    processData: false,
                    success: function(response) {
                        $('#loading').hide()
                        alert('Đã cập nhật cấp độ dịch!')
                    },
                    error: function(data) {
                        $('#loading').hide()
                        alert(data.responseText)
                    }
                })
            }))

            $('#form_upload').submit()
        }
    </script>

    <script src="./../../public/javascripts/imageuploadify.min.js"></script>
    <script src="./../../public/javascripts/imageuploadify.js"></script>

    <script>
        $('input[name="avatar"]').imageuploadify()
        $("input").attr("autocomplete", "off")
    </script>

</body>

</html>